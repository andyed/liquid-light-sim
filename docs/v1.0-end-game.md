# v1.0 End Game: Blobby, Stable, and Multi-Material Oil

The goal is to achieve a stable, visually appealing simulation with distinct, "blobby" oil behaviors and support for multiple, non-interfering oil types on the canvas at the same time.

---

### Phase 1: Two-Pass Surface Tension (Blobby Blobs)

This phase focuses on getting the "blobby" behavior right for a single oil type. This will be a significant visual improvement and a good self-contained task.

1.  **Curvature Pass**:
    *   Create a new `curvature.frag.glsl` shader that takes the oil thickness as input.
    *   This shader will accurately calculate the curvature of the oil's surface and store it in a new texture.

2.  **Surface Tension Force Pass**:
    *   Create a new `apply-surface-tension.frag.glsl` shader.
    *   This shader will use the curvature texture to apply a force to the oil, pushing it from areas of high curvature to areas of low curvature. This is what will create the "blobby" shapes.

3.  **Integration**:
    *   Integrate these two new shader passes into the `OilLayer.js` update cycle.
    *   Add a `surfaceTensionIterations` parameter to the material presets to control the smoothness of the blobs.

---

### Phase 2: Per-Pixel Material Properties (Multi-Material Simulation)

This phase is a major architectural change that will enable multiple, non-interfering oil types on the canvas at the same time.

1.  **New Material Texture**:
    *   Introduce a new `materialTexture` to the simulation. This texture will store the physical properties (viscosity, surface tension, etc.) of the oil at each pixel.

2.  **Shader Modifications**:
    *   Modify all the oil-related shaders to read their parameters from the `materialTexture` instead of using global uniforms.

3.  **Splat Method Modification**:
    *   Update the `splatColor` method for oil to write the material properties of the currently selected material to the `materialTexture` when you splat a new blob.

4.  **Blending Strategy**:
    *   For v1.0, we'll use a simple "new blob wins" blending strategy. When two blobs of different materials merge, the new blob will take on the properties of the material that is being splatted.

---

### Execution Plan

We will tackle these two phases sequentially:

1.  **First, Phase 1 (Two-Pass Surface Tension)**: This will give us the desired "blobby" behavior and will be a significant visual improvement.
2.  **Then, Phase 2 (Per-Pixel Material Properties)**: This is a much larger and more disruptive change, but it will deliver the final, multi-material simulation.

This phased approach will allow us to make steady progress and have a usable, improved simulation at the end of each phase.
