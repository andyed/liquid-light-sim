

# **Technical Specification: Liquid Light FX – Digital Simulation of Psychedelic Liquid Light Shows**

## **Introduction and Project Goals**

This document provides the comprehensive technical specification for "Liquid Light FX," a real-time, digital simulation designed to accurately reproduce the aesthetic and fluid dynamics of the immiscible oil-on-water liquid light shows associated with the 1960s psychedelic movement, notably the phenomena surrounding Ken Kesey's Merry Pranksters and the Electric Kool-Aid Acid Tests.1 The project mandate extends beyond simple fluid mechanics, requiring the capture of the cultural "happening" ethos, high-contrast psychedelic color palettes, and specific optical artifacts generated by analog overhead projectors.

The core technical solution relies on Graphics Processing Unit (GPU) acceleration, leveraging WebGL 2.0 or WebGPU for high-performance computational fluid dynamics (CFD) and a complex rendering pipeline to simulate light refraction and focus. The targeted output is a highly detailed, interactive simulation achieving a smooth, real-time frame rate of 60 frames per second (FPS).

For details on recent improvements to the physical accuracy of the simulation, please see the [Physics Accuracy Improvements](physics-accuracy.md) document.

### **Purpose and Scope**

The primary objective is to develop a mathematically rigorous yet aesthetically authentic digital projection system. This system will utilize modern web graphics APIs to simulate two-phase fluid behavior (mineral oil and water/alcohol) 3 and translate the resultant interface distortions into projected light (caustics and refraction).5 The simulation is scoped to focus entirely on the two-dimensional surface tension phenomena typically observed when liquids are squeezed between glass plates atop an overhead projector.1 The resulting architecture will be modular, emphasizing open-source integration where feasible, primarily through the Three.js ecosystem.7

## **I. Conceptual Foundation and Aesthetic Requirements (The Vibe)**

Achieving fidelity to the 1960s light show requires defining non-functional requirements that integrate cultural context with technical implementation, reflecting the raw, improvised nature of the original art form.8

### **1.1. The Electric Kool-Aid/Merry Prankster Aesthetic**

The simulation must deliberately avoid the sterile perfection often associated with pure digital graphics. The output must embody the sensory overload and chaotic, improvised spirit of the "happening" events that characterized the Acid Tests.2 The design philosophy dictates that the visualization should appear raw, physically manipulated, and reminiscent of homemade projection instruments.8

The historical context, rooted in non-conformity and the rejection of pristine modernism 9, suggests that striving for mathematically perfect flow simulation alone would yield a visually unsatisfying result. Therefore, specific contextual artifacts must be implemented to enhance the chaotic psychedelic feeling and elevate the aesthetic fidelity to the 1960s projection technology. This includes supporting optional integration of simulated strobe light flicker, rapid camera movements (simulating an operator bumping the projector), projection noise, and dust effects. Furthermore, the simulation should model projection light bleed, achieved via high-intensity Bloom or God Rays filtering 10, intentionally disrupting perfect photorealism to capture the intensity and visual instability of the era.

### **1.2. Psychedelic Color Theory and Vibration**

The colors projected in the 1960s were often intense, derived from concentrated dyes such as Flo-Master ink or Vitrina.11 Historical palettes included names like "Blue Cheer," "Purple Haze," and "Sunshine Yellow".12

The core requirement is to simulate the phenomenon of "vibrating color," a hallmark of psychedelic design, which creates a retinal stress effect.14 This effect is not achieved merely by high saturation; it requires the juxtaposition of complementary or opposing hues that maintain near-identical **perceptual lightness** (L value).15 The specification mandates that all color mixing calculations must first occur within a perceptually uniform color space (such as Oklab) to normalize the lightness values of the opposing colors before the final color space conversion for rendering.15

Color implementation must also account for the physics of light subtraction, as the colored liquids act as filters. If highly saturated dyes are used, or if primary colors of light (Red, Green, Blue) are superimposed, the total light output decreases dramatically, blocking most wavelengths.16 The system must model this color subtraction and accumulation, controlling local opacity and hue via an advected scalar Color Field ($C$).

### **1.3. Analog System Decomposition and Interaction**

The simulation must model the light path of an overhead projector, where a light source shines through the fluid interface (CFD domain) and then through a single projection lens before hitting the screen.17

#### **1.3.1. Operator Input Mechanics**

The core interactivity of the original light show was the live, hands-on manipulation of the liquid dish.8 The digital simulation must translate these physical manipulations into highly responsive inputs for the fluid solver:

* **The Jiggle:** This technique, described as rocking the glass dish 16, is mathematically translated into a high-frequency, low-amplitude, non-uniform external force field.18 This impulse field is applied to the velocity domain ($\\vec{u}$) to create rapid, turbulent fluctuations in the fluid surface, driving immediate, visible flow activity.  
* **The Spin:** The 'Spin' involves rotating the dish to build up a slow, global flow.16 This is modeled as a continuous, rotational, low-decay velocity impulse applied to the boundary conditions of the simulation grid.19 This rotational momentum is crucial for developing the large, hypnotic vortices that characterize the slow, building nature of the flow.  
* **Focus Control:** The focus is perhaps the most significant non-CFD visual control. The original operator adjusted the distance between the overhead projector lens and the projection surface.16 This is implemented as a non-physical scalar control variable, $Z\_f$ (Focus Depth), which dictates the intensity of a high-quality post-processing blur (e.g., Gaussian diffusion) applied *after* the caustics mapping stage.16 This allows the user to transition the projection from a sharp, crisp focus where the fluid boundaries are clearly defined, to a softer focus where lines blend and diffuse, creating the characteristic soft, shifting clouds that reduce the harshness of the edge.16

## **II. Physical Modeling and Material Properties (The Wetware)**

This section establishes the material parameters and the computational fluid dynamics (CFD) model required to simulate two distinct, immiscible phases—oil and water/alcohol—interacting under surface tension. Standard single-phase fluid solvers, which typically model smoke or gas, are insufficient for this project.20

### **2.1. Immiscible Phase Definition and Properties**

The simulation must model two separate fluids that do not mix (hydrophobic characteristics of oil).3

* **Continuous Phase (Water/Alcohol):** This phase is higher in density ($\\rho\_w \\approx 1000 \\, \\text{kg/m}^3$) and lower in viscosity, providing the base fluid.3 Ethanol or alcohol was often mixed with the water 11, yielding a refractive index ($n\_c$) in the range of $1.33$ (water) to $1.36$ (alcohol).22  
* **Dispersed Phase (Mineral Oil/Kerosene):** This phase is lower in density ($\\rho\_o \\approx 850 \- 950 \\, \\text{kg/m}^3$) and carries the highly concentrated color dyes.3 It is modeled as floating on top of the continuous phase. Mineral oil and kerosene have a significantly higher refractive index ($n\_d$), typically ranging from $1.44$ to $1.48$.22

#### **2.1.1. Refractive and Viscosity Contrast**

The physical authenticity of the projection is entirely dependent on the contrast between these properties. The substantial difference in refractive index ($\\Delta n \= n\_d \- n\_c$) generates the optical distortion (caustics) visible in the projection. Furthermore, the observed flow patterns—slow, thick, coherent blobs that resist rapid stretching—are governed by the viscosity ratio ($k \= \\mu\_o / \\mu\_c$). Since mineral oil is significantly more viscous than water 3, a high viscosity ratio is required to maintain the integrity of the oil droplets and prevent them from immediately dissolving like a dye. Based on physical descriptions, the simulation must support a ratio $k$ ranging from $5$ to $50$ to capture the appropriate internal friction necessary for the characteristic slow, hypnotic, momentum-building movement observed in the light shows.16

Table of Key Material Constants

| Material | Refractive Index (nD​) | Approximate Density (kg/m3) | Viscosity Ratio (k \= μd​/μc​) |
| :---- | :---- | :---- | :---- |
| Air (Above Surface) | 1.0003 22 | N/A | N/A |
| Water/Alcohol Mix (Continuous Phase) | 1.33 – 1.36 22 | $\\approx 1000$ | $\\mu\_c \= 1.0$ (Baseline) |
| Mineral Oil/Kerosene (Dispersed Phase) | 1.44 – 1.48 22 | $\\approx 900$ | $5$ to $50$ |
| Projection Glass (Boundary) | $\\approx 1.50$ 22 | N/A | N/A |

### **2.2. Computational Fluid Dynamics (CFD) Model Selection**

The simulation of immiscible fluids with density and viscosity contrast is a complex challenge that cannot be solved by simple density advection models. To accurately model the interface and the maintenance of droplet integrity (surface tension), the model must track the boundary between the phases.

The mandated model is a **Navier-Stokes solver coupled with a Phase Field Model (PFM)**.4

#### **2.2.1. Phase Field Justification**

The PFM introduces a continuous scalar field, $\\Phi$, which smoothly transitions from one value (e.g., $\\Phi \= 1$ for oil) to another ($\\Phi \= 0$ for water/alcohol). This method is highly effective for dealing with density and viscosity contrasts and naturally handles surface tension forces, which are critical for the appearance of coherent oil blobs.4

The PFM approach is particularly well-suited for a GPGPU implementation because it requires only a scalar field to represent the interface, eliminating the need for complex geometric tracking or re-distancing operations inherent in some alternative methods like the Level Set Method (LSM).25 The use of a smooth, continuous field $\\Phi$ is essential for translation into GPGPU shader logic, allowing the entire physical evolution to be handled in parallel via texture manipulation.

#### **2.2.2. GPGPU Mandate**

All core physical computations—including advection, pressure solving, and Phase Field evolution—must be implemented as General Purpose GPU (GPGPU) algorithms. These calculations must execute within custom GLSL fragment shaders (or WebGPU compute shaders if supported) operating on floating-point texture buffers (Frame Buffer Objects or FBOs) for maximum performance and parallelism.27

## **III. GPGPU Simulation Architecture (The Engine)**

The simulation engine is built upon the projection method for incompressible flow, implemented entirely within the GPU pipeline.

### **3.1. Data Structures (Texture Buffers)**

The complete simulation state must be stored in 2D floating-point textures, leveraging WebGL 2.0 or WebGPU capabilities for accurate, non-integer storage of physics variables.27 These textures are updated iteratively using a flip-flop technique, where the current state is read from one buffer and the new state is written to another.

| Texture Field | Type/Format | Purpose |
| :---- | :---- | :---- |
| Velocity Field ($\\vec{u}$) | RGBA (Float), R/G for $u\_x, u\_y$ | Stores the 2D flow velocity vector at each grid point. |
| Phase Field ($\\Phi$) | R (Float) | Stores the phase concentration ($\\Phi \= 1$ for oil, $\\Phi \\le 0$ for water/alcohol). Tracks interface position. |
| Color Field ($C$) | RGBA (Float) | Stores the highly saturated dye concentration/color value for visualization. |
| Pressure Field ($P$) | R (Float) | Stores scalar pressure needed to enforce incompressibility. |
| Divergence Field ($D$) | R (Float) | Stores the divergence ($\\nabla \\cdot \\vec{u}$) of the intermediate velocity field. |
| Viscosity Field ($\\mu$) | R (Float) | Dynamically mapped viscosity based on $\\Phi$, enabling realistic contrast. |

### **3.2. GPGPU Phase Field Simulation Pipeline**

The simulation loop is a sequence of highly optimized fragment shader passes executed at every time step.21

1. **Viscosity and Density Mapping:** A shader pass utilizes the Phase Field $\\Phi$ to calculate and update the local viscosity $\\mu(\\Phi)$ and density $\\rho(\\Phi)$ fields, ensuring accurate physical properties are used for flow calculation, particularly across the interface.4  
2. **Advection:** The key state variables, the Velocity Field ($\\vec{u}$) and the Phase Field ($\\Phi$), are transported using a semi-Lagrangian advection scheme.21 This method is chosen for its unconditional stability, which is essential for maintaining predictable flow under variable user input.  
3. **External Forces and Boundary Impulse:** A dedicated pass applies all external forces to the advected velocity field ($\\vec{u}\_{a}$). This includes user input (mouse/touch), buoyancy forces (based on density contrast and $\\nabla \\Phi$), and the operator-controlled forces, specifically the high-frequency 'Jiggle' impulse and the sustained rotational 'Spin' vector.16 Crucially, capillary forces (surface tension) are calculated based on the Phase Field gradient ($\\nabla \\Phi$) and are added here to maintain the physical coherence and shape of the oil blobs.4  
4. **Divergence Calculation:** The intermediate velocity field ($\\vec{u}\_f$) is tested for volume change (divergence) in a separate pass: $D \= \\nabla \\cdot \\vec{u}\_f$.21  
5. **Pressure Solve (Jacobi Iteration):** The divergence field $D$ drives the solution of the Poisson pressure equation ($\\nabla^2 P \= D$). This step iteratively uses the Jacobi method across multiple passes (10 to 20 iterations recommended) to find the pressure $P$ necessary to achieve a divergence-free (incompressible) flow.27 The required high iteration count is critical for physical fidelity. Low iteration counts lead to numerically unstable, "squishy" fluid that visually expands and contracts unrealistically. To ensure the fluid appears suitably "heavy" and incompressible, minimizing numerical errors requires significant overhead, stressing the importance of GPU optimization and resolution management.21  
6. **Projection and Color Advection:** The final, divergence-free velocity field ($\\vec{u}\_{n+1}$) is calculated by subtracting the pressure gradient ($\\vec{u}\_{n+1} \= \\vec{u}\_f \- \\nabla P\_{final}$). Finally, the visual Color Field ($C$) is advected through this divergence-free velocity field.21

## **IV. Rendering and Projection Effects Pipeline (The Optics)**

The visual impact of the light show is derived not from the fluid dynamics display itself, but from the optical transformation (refraction) caused by the fluid interface acting as a dynamic lens. This conversion requires a multi-stage rendering pipeline.

### **4.1. Displacement Field Generation**

The fluid data must first be converted into geometric information usable by the rendering shaders.

1. **Height Map Generation:** The Phase Field $\\Phi$ defines the 2D surface interface. This is utilized to generate a Height Map $H$, which represents the varying elevation of the fluid surface boundary as the light rays pass through it.  
2. **Normal Map Calculation:** The Normal Map $N$ must be calculated directly from the Height Map $H$ using finite differences.29 This Normal Map provides the local surface orientation (normal vector $\\vec{n}$) for every point on the fluid interface, which is the necessary parameter for applying Snell’s Law to compute refraction.6

### **4.2. Caustics and Refraction Mapping**

This stage simulates the characteristic projection effect—the focusing and distortion of light caused by the rippling oil interface.5

* **Snell’s Law Implementation:** A dedicated fragment shader is employed to perform a 2D approximation of light ray tracing. For each projected pixel, the shader reads the corresponding Normal Map $N$ and the predetermined refractive index contrast ($\\Delta n$) of the oil and water phases.22 These parameters are used to calculate the direction of the refracted light ray based on Snell's Law.6  
* **Caustics Texture Generation:** The calculated refracted ray direction is used to determine a warped texture coordinate for a base "Sun" map (a flat white texture simulating the light source). This generates the Caustics Texture ($T\_{caustics}$), which represents the light intensity distribution on the projected screen.6  
* **Color Integration:** The final visual output is produced by modulating the $T\_{caustics}$ intensity with the color data from the advected Color Field $C$. This confirms that the fluid simulation texture is merely an intermediate physics data output; the final, optically correct image is derived solely from the light distortion pipeline.31

### **4.3. Focus Simulation (The Psychedelic Blur)**

The ability to manually adjust the focus is a paramount aesthetic requirement. This technique allowed operators to soften the often harsh, crisp boundaries of the oil projection.16

The user control variable $Z\_f$ (Focus Depth) must be exposed as a visual tuning parameter. $Z\_f$ determines the intensity of a high-quality Post-Processing Blur filter (e.g., separable Gaussian blur or a specialized Depth-of-Field algorithm) applied directly to the final Caustics Texture $T\_{caustics}$. Adjusting $Z\_f$ simulates the physical movement of the projector lens.16 When $Z\_f$ is high (soft focus), the caustics blur and diffuse, generating the desired soft, nebulous cloud patterns that align with the classic psychedelic aesthetic, where the sharp definition of the interface is deliberately obscured.16

### **4.4. Post-Processing and Output Filtering**

The final rendered image must be processed to replicate the artifacts of an analog projection system. This includes:

* **Bloom and Glow:** A mandatory high-radius Bloom filter must be applied to simulate the intense wattage and resulting light leakage characteristic of analog overhead projectors.10  
* **Chromatic Aberration:** To simulate realistic lens imperfections, a slight displacement of the Red, Green, and Blue color channels must be applied, increasing toward the edges of the projection surface.  
* **Vignette and Noise:** Subtle static grain noise and edge darkening (vignette) are necessary to enhance the impression of an analog film or projection artifact.32

## **V. Technology Stack, Architecture, and Open Source Integration**

### **5.1. Technology Stack**

The project relies on a high-performance modern web technology stack:

* **Primary Framework:** **Three.js**.7 Utilized for establishing the rendering scene (camera, renderer), managing the geometry (a simple screen quad), and facilitating the post-processing chain via THREE.EffectComposer.10  
* **CFD Engine Core:** **Pure WebGL 2.0 or WebGPU**.34 The physics core must be implemented using low-level shader programming. WebGL 2.0 is the minimum supported API due to its required support for floating-point textures.27 WebGPU, if supported by the target environment, is strongly recommended, as its explicit Compute Shader capability offers a significant performance advantage for highly iterative GPGPU tasks like the Jacobi pressure solve.34  
* **Language/Build:** TypeScript and JavaScript, bundled via a modern toolchain such as Webpack.20

### **5.2. Recommended Architecture**

A clear separation of concerns must be enforced to manage the complexity of the physics simulation and rendering.35

* **index.html:** Root file, establishing the scene container (\#scene-container) where the Three.js canvas will be injected.33  
* **src/main.js:** Application entry point. Initializes the SceneManager instance and registers all necessary DOM listeners for user interaction (mouse input, window resizing).35  
* **src/SceneManager.js:** The high-level component responsible for Three.js setup, including the scene, renderer, and camera. It initializes and manages the FluidSolver and PostProcessor classes, and drives the main render loop (requestAnimationFrame).35  
* **src/FluidSolver.js:** The core physics computation class. It manages all FBOs and custom shader programs, executing the 6-step GPGPU physics pipeline (Section 3.2). It exposes clean methods (applyJiggle, applySpin, applyImpulse) to receive inputs from the SceneManager.  
* **src/Shaders/:** A directory containing all necessary GLSL source code for physics (Advection, Pressure Solve, Divergence, Phase Field Update) and rendering (Normal Map generation, Refraction/Caustics, Post-Effects).

### **5.3. Open Source Library Integration**

To accelerate development of the core Navier-Stokes backbone, referencing established open-source projects is prudent.

* The implementation structure and techniques demonstrated in **amsXYZ/three-fluid-sim** or Pavel Dobryakov's **WebGL Fluid Simulation** provide excellent starting points for implementing GPGPU-based incompressible flow via the backward tracing/Jacobi iteration methodology.20  
* **Crucial Adaptation:** While these libraries provide a framework for single-phase flow, they lack the specialized mechanics for immiscibility. The project requires extensive, specialized modification of the core shaders to integrate the Phase Field Model (PFM), the capillary force calculation, and the dynamic viscosity mapping required to handle the large density and viscosity contrast between oil and water.4 This specialized modification represents the most technically challenging and customized component of the simulation.

## **VI. System Requirements and Performance Metrics**

### **6.1. Minimum Hardware Specifications**

The required GPGPU workload necessitates a capable graphics processing unit capable of high floating-point precision and rapid texture read/write operations.

| Component | Minimum Requirement | Justification |
| :---- | :---- | :---- |
| **API Support** | WebGL 2.0 (Mandatory) or WebGPU (Recommended) | Required for floating-point textures and accelerated parallelism. 34 |
| **GPU** | NVIDIA GeForce GTX 1660 equivalent or high-end integrated graphics produced within the last two years | Essential for rapid execution of the 10+ Jacobi iterations per frame and managing high-resolution texture swaps. 36 |
| **CPU** | Quad-core CPU (3.0 GHz+) | Necessary for managing the rendering loop overhead and data transfer coordination. 36 |

### **6.2. Performance Metrics and Simulation Resolution**

* **Target Frame Rate:** 60 FPS (required for smooth, visually hypnotic, real-time interactivity).  
* **Simulation Grid Resolution:** The internal physics must run at a minimum resolution of $512 \\times 512$ texture dimensions for the $\\vec{u}$, $P$, and $\\Phi$ fields. A higher resolution (e.g., $1024 \\times 1024$) is necessary for capturing fine-scale turbulent vortex details, though this significantly impacts performance.  
* **Resolution Optimization Strategy:** To mitigate the computational cost of high-fidelity physics (high Jacobi iteration count and large viscosity contrast), the system must utilize subsampling.38 The expensive fluid dynamics calculation (Steps 1-6 in Section 3.2) should be solved on the $512 \\times 512$ grid, while the final rendering passes (Caustics and Post-Processing) should be executed at the screen resolution, relying on bilinear interpolation and the Focus blur effect to smooth out artifacts caused by the lower-resolution physics grid.38 This strategic compromise prioritizes the perception of smooth, continuous motion over microscopic grid fidelity, ensuring the 60 FPS target is met on consumer hardware.

## **Conclusions and Technical Recommendations**

The successful execution of Liquid Light FX hinges on overcoming two primary technical challenges: the accurate physical simulation of two-phase flow and the subsequent optical simulation of light refraction.

1. **Immiscible Fluid Necessity:** The analysis confirms that the simulation requires a complex interface-tracking approach, such as the Navier-Stokes/Phase Field Model 4, rather than relying on simpler single-phase models. The unique, highly viscous, dense blob movement characteristic of oil shows demands that surface tension and density contrast be rigorously modeled and that the viscosity ratio ($k$) be adjustable to match physical observations.3  
2. **Optical Priority:** The visual effect is driven by the dynamic lens created by the fluid interface, not the raw color distribution. The pipeline must prioritize the generation of the Normal Map from the fluid interface ($\\Phi$) and the subsequent calculation of the Caustics Texture via Snell's Law.5 This optical pipeline is the source of the simulation’s perceived realism.  
3. **Aesthetic Controls:** The specification elevates the **Focus Control** ($Z\_f$) from a simple user interface knob to a critical aesthetic tool. By linking $Z\_f$ to a post-processing Gaussian blur on the caustics map, the simulation can seamlessly transition between high-contrast definition and the soft, diffusing cloud patterns that define the deepest psychedelic experiences, ensuring fidelity to the operator’s analog manipulation techniques.16  
4. **Performance Trade-offs:** The technical demands of high iteration counts for incompressibility conflict directly with the target frame rate. The mandated strategy of subsampling the physics grid resolution while relying on interpolation and post-processing smoothing is essential to achieve the desired visual fidelity without sacrificing real-time performance on typical GPU hardware.38

#### **Works cited**

1. Liquid Light Show Oil and Water Clock Face Technique \- 1080 HD \- YouTube, accessed October 25, 2025, [https://www.youtube.com/watch?v=CAd5sxSWLCg](https://www.youtube.com/watch?v=CAd5sxSWLCg)  
2. The Electric Kool' Aid Acid Test | News \- The Harvard Crimson, accessed October 25, 2025, [https://www.thecrimson.com/article/1968/10/19/the-electric-kool-aid-acid-test/](https://www.thecrimson.com/article/1968/10/19/the-electric-kool-aid-acid-test/)  
3. Mineral Oil Properties: Essential Characteristics for Industry \- diplomata comercial, accessed October 25, 2025, [https://diplomatacomercial.com/glossario/mineral-oil-properties-essential-characteristics-for-industry/](https://diplomatacomercial.com/glossario/mineral-oil-properties-essential-characteristics-for-industry/)  
4. Phase-field-based lattice Boltzmann model for incompressible binary fluid systems with density and viscosity contrasts | Phys. Rev. E \- Physical Review Link Manager, accessed October 25, 2025, [https://link.aps.org/doi/10.1103/PhysRevE.87.043301](https://link.aps.org/doi/10.1103/PhysRevE.87.043301)  
5. Rendering Realtime Caustics in WebGL | by Evan Wallace \- Medium, accessed October 25, 2025, [https://medium.com/@evanwallace/rendering-realtime-caustics-in-webgl-2a99a29a0b2c](https://medium.com/@evanwallace/rendering-realtime-caustics-in-webgl-2a99a29a0b2c)  
6. Chapter 2\. Rendering Water Caustics \- NVIDIA Developer, accessed October 25, 2025, [https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-2-rendering-water-caustics](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-2-rendering-water-caustics)  
7. Computational Fluid Dynamics Animation Viewer : r/threejs \- Reddit, accessed October 25, 2025, [https://www.reddit.com/r/threejs/comments/1bbtx6u/computational\_fluid\_dynamics\_animation\_viewer/](https://www.reddit.com/r/threejs/comments/1bbtx6u/computational_fluid_dynamics_animation_viewer/)  
8. UC Visuals | the art of liquid light, accessed October 25, 2025, [https://ucvisuals.com/](https://ucvisuals.com/)  
9. The Inevitability of Conformity: Ideology in Tom Wolfe's The Electric Kool-Aid Acid Test \- Fisher Digital Publications, accessed October 25, 2025, [https://fisherpub.sjf.edu/cgi/viewcontent.cgi?article=1002\&context=english\_undergraduate](https://fisherpub.sjf.edu/cgi/viewcontent.cgi?article=1002&context=english_undergraduate)  
10. How to Create Realistic Lighting Effects with WebGL \- PixelFreeStudio Blog, accessed October 25, 2025, [https://blog.pixelfreestudio.com/how-to-create-realistic-lighting-effects-with-webgl/](https://blog.pixelfreestudio.com/how-to-create-realistic-lighting-effects-with-webgl/)  
11. Liquid light show \- Wikipedia, accessed October 25, 2025, [https://en.wikipedia.org/wiki/Liquid\_light\_show](https://en.wikipedia.org/wiki/Liquid_light_show)  
12. 8 Color Set \- 1 Oz. Concentrated Oil Dyes for Liquid Light Shows, accessed October 25, 2025, [https://www.liquidlightshop.com/product/complete-8-color-set-concentrated-oil-dye-1-oz-bottles-non-toxic-formula](https://www.liquidlightshop.com/product/complete-8-color-set-concentrated-oil-dye-1-oz-bottles-non-toxic-formula)  
13. Dyes \- Liquid Light Lab, accessed October 25, 2025, [https://www.liquidlightshop.com/category/dyes](https://www.liquidlightshop.com/category/dyes)  
14. How Psychedelic 60s Art Changed Design Forever \- Network9, accessed October 25, 2025, [https://network9.biz/how-psychedelic-60s-art-changed-design-forever/](https://network9.biz/how-psychedelic-60s-art-changed-design-forever/)  
15. The psychedelic '60s color combos that vibrate off the page \- Hoppn, accessed October 25, 2025, [https://labs.hoppn.com/blog/the-psychedelic-60s-color-combos-that-vibrate-off-the-page](https://labs.hoppn.com/blog/the-psychedelic-60s-color-combos-that-vibrate-off-the-page)  
16. Old School Psychedelic Light Show : 5 Steps (with Pictures) \- Instructables, accessed October 25, 2025, [https://www.instructables.com/Old-School-Psychedelic-Light-Show/](https://www.instructables.com/Old-School-Psychedelic-Light-Show/)  
17. How to produce a psychedelic light show \- Wild Bohemian, accessed October 25, 2025, [https://wild-bohemian.com/liteshow.htm](https://wild-bohemian.com/liteshow.htm)  
18. Impulse Fluid Simulation \- Dartmouth Computer Science, accessed October 25, 2025, [https://www.cs.dartmouth.edu/\~bozhu/papers/impulse\_fluid.pdf](https://www.cs.dartmouth.edu/~bozhu/papers/impulse_fluid.pdf)  
19. Controlling the Bounce of a Bottle \- Physical Review Link Manager, accessed October 25, 2025, [https://link.aps.org/doi/10.1103/Physics.16.102](https://link.aps.org/doi/10.1103/Physics.16.102)  
20. amsXYZ/three-fluid-sim: ✒️ 2D Fluid Simulation three.js ... \- GitHub, accessed October 25, 2025, [https://github.com/amsXYZ/three-fluid-sim](https://github.com/amsXYZ/three-fluid-sim)  
21. Fluid Simulation (with WebGL demo) \- Jamie Wong, accessed October 25, 2025, [https://jamie-wong.com/2016/08/05/webgl-fluid-simulation/](https://jamie-wong.com/2016/08/05/webgl-fluid-simulation/)  
22. Reference Sheet \- Refractive Index | Secondary \- Alloprof, accessed October 25, 2025, [https://www.alloprof.qc.ca/en/students/vl/chemistry/reference-sheet-refractive-index-c1711](https://www.alloprof.qc.ca/en/students/vl/chemistry/reference-sheet-refractive-index-c1711)  
23. List of refractive indices \- Wikipedia, accessed October 25, 2025, [https://en.wikipedia.org/wiki/List\_of\_refractive\_indices](https://en.wikipedia.org/wiki/List_of_refractive_indices)  
24. Oil=water initial viscosity ratios | Download Table \- ResearchGate, accessed October 25, 2025, [https://www.researchgate.net/figure/Oilwater-initial-viscosity-ratios\_tbl1\_236612010](https://www.researchgate.net/figure/Oilwater-initial-viscosity-ratios_tbl1_236612010)  
25. Bixio999/3d-fluid-simulation: A real-time 3D fluid simulation in OpenGL \- GitHub, accessed October 25, 2025, [https://github.com/Bixio999/3d-fluid-simulation](https://github.com/Bixio999/3d-fluid-simulation)  
26. Chapter 30\. Real-Time Simulation and Rendering of 3D Fluids | NVIDIA Developer, accessed October 25, 2025, [https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-30-real-time-simulation-and-rendering-3d-fluids](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-30-real-time-simulation-and-rendering-3d-fluids)  
27. mishurov/fluid: A real time fluid simulation using OpenGL shaders \- GitHub, accessed October 25, 2025, [https://github.com/mishurov/fluid](https://github.com/mishurov/fluid)  
28. WebGL Shaders and GLSL, accessed October 25, 2025, [https://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html](https://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html)  
29. Generating a normal map from a height map? \- Stack Overflow, accessed October 25, 2025, [https://stackoverflow.com/questions/5281261/generating-a-normal-map-from-a-height-map](https://stackoverflow.com/questions/5281261/generating-a-normal-map-from-a-height-map)  
30. NormalMap-Online \- Github cpetry, accessed October 25, 2025, [https://cpetry.github.io/NormalMap-Online/](https://cpetry.github.io/NormalMap-Online/)  
31. Water Walkthrough \- Alex Tardif: Graphics Programmer, accessed October 25, 2025, [https://alextardif.com/Water.html](https://alextardif.com/Water.html)  
32. Post-processing with WebGL \- WebPlatform.org, accessed October 25, 2025, [https://webplatform.github.io/docs/tutorials/post-processing\_with\_webgl/](https://webplatform.github.io/docs/tutorials/post-processing_with_webgl/)  
33. The Structure of a three.js App, accessed October 25, 2025, [https://discoverthreejs.com/book/first-steps/app-structure/](https://discoverthreejs.com/book/first-steps/app-structure/)  
34. WebGPU Fluid Simulations: High Performance & Real-Time Rendering \- Codrops, accessed October 25, 2025, [https://tympanus.net/codrops/2025/02/26/webgpu-fluid-simulations-high-performance-real-time-rendering/](https://tympanus.net/codrops/2025/02/26/webgpu-fluid-simulations-high-performance-real-time-rendering/)  
35. How to organize your Three.js code in a cleaner way | by Pierfrancesco Soffritti | Medium, accessed October 25, 2025, [https://pierfrancesco-soffritti.medium.com/how-to-organize-the-structure-of-a-three-js-project-77649f58fa3f](https://pierfrancesco-soffritti.medium.com/how-to-organize-the-structure-of-a-three-js-project-77649f58fa3f)  
36. System Requirements \- FlexSim, accessed October 25, 2025, [https://docs.flexsim.com/en/21.1/Reference/SystemRequirements/SystemRequirements.html](https://docs.flexsim.com/en/21.1/Reference/SystemRequirements/SystemRequirements.html)  
37. System requirements for Autodesk Fusion, accessed October 25, 2025, [https://www.autodesk.com/support/technical/article/caas/sfdcarticles/sfdcarticles/System-requirements-for-Autodesk-Fusion-360.html](https://www.autodesk.com/support/technical/article/caas/sfdcarticles/sfdcarticles/System-requirements-for-Autodesk-Fusion-360.html)  
38. WEBGL SHADERS \- AMANDA GHASSAEI, accessed October 25, 2025, [https://amandaghassaei.com/projects/shaders](https://amandaghassaei.com/projects/shaders)

## **VII. Future Improvements and TODO**

### **7.2. Simulating Interacting Oils and Peacock Displays**

**Vision:**
The next major step in improving the simulation's realism is to model the interaction of different types of oil. In real liquid light shows, artists would use oils of varying densities and viscosities. Heavier, more viscous oils would tend to "stay" in place, while lighter, less viscous oils would flow around them, creating intricate, feather-like patterns often described as "peacock displays".

**Implementation Plan:**

1.  **Extend `materialFBO` to a Multi-Property Texture:**
    -   The `materialFBO` will be used to store a vector of physical properties for each point in the fluid. The four channels (RGBA) of the texture can be used to store:
        -   **R:** Viscosity
        -   **G:** Surface Tension
        -   **B:** Buoyancy
        -   **A:** A property to control color mixing, allowing oils of the same type to mingle while different types remain separate.

2.  **Update `splatFrag` and `applyImpulse`:**
    -   The `applyImpulse` function in `FluidSolver.js` will be modified to accept a full set of material properties for the ink being poured.
    -   The `splatFrag` shader will be updated to write these properties into the `materialFBO`.

3.  **Update Physics Shaders for Local Properties:**
    -   The core physics shaders (`forcesFrag`, `viscosityFrag`) will be significantly modified to use local, per-pixel properties instead of global uniforms.
    -   For example, in `forcesFrag`, the `u_surfaceTension` and `u_buoyancy` uniforms will be removed. Instead, these values will be sampled from the `materialFBO` at each pixel.
    -   This will allow different parts of the fluid to have different surface tensions and buoyancies, leading to the desired complex interactions.

4.  **Color Mingling:**
    -   The 'A' channel of the `materialFBO` can be used to store a "type" or "family" identifier for the oil.
    -   The color mixing logic in `advectionColorFrag` can be updated to check this identifier. If two oils have the same identifier, their colors can be allowed to mix. If they are different, the mixing can be prevented, and they will flow around each other. This will allow for the effect of "oils of different colors but same times sometimes join and mingle".

**Problem:**
The current simulation uses a single, global value for viscosity that applies to the entire fluid. When the user selects a new material (e.g., "Heavy Syrup"), the viscosity of the *entire* fluid simulation is instantly changed to match the new material. This is physically incorrect and counter-intuitive. The material of the ink "in your hand" should not affect the fluid that is already on the plate.

**Correct Solution (The Plan):**
The simulation needs to be re-architected to support per-particle (or per-grid-cell) material properties. This means that viscosity, and potentially other properties like surface tension and buoyancy, should not be global uniforms, but rather fields that are stored in textures and advected with the fluid.

**Implementation Steps:**

1.  **Create a `materialProperties` FBO:**
    -   In `FluidSolver.js`, create a new set of floating-point textures (FBOs) to store material properties. A single RGBA texture could store viscosity in the R channel, surface tension in the G, buoyancy in the B, etc. Let's call it `materialFBO`.

2.  **Modify `splatFrag` to write material properties:**
    -   When a new splat of ink is added, the `splatFrag` shader will need to write the properties of the currently selected material into the `materialFBO` at the location of the splat.
    -   This will require passing the material properties from `SceneManager.js` to `FluidSolver.js` and then to the shader as uniforms.

3.  **Advect the `materialFBO`:**
    -   In the `update` loop of `FluidSolver.js`, the `materialFBO` must be advected along with the velocity, phase, and color fields. This will ensure that the material properties move with the fluid.

4.  **Update Physics Shaders (`forcesFrag`, `viscosityFrag`):**
    -   The `forcesFrag` and `viscosityFrag` shaders, which currently use global uniforms like `u_viscosityRatio` and `u_surfaceTension`, must be modified.
    -   They will need to sample the `materialFBO` at the current fragment's coordinates (`v_uv`) to get the local material properties.
    -   These local properties will then be used in the physics calculations (e.g., calculating damping based on local viscosity).

5.  **Update `SceneManager.js`:**
    -   The `setMaterial` function will no longer directly update the uniforms in the physics shaders. Instead, it will just store the properties of the currently selected material.
    -   When the user clicks to pour, these properties will be passed to the `applyImpulse` function in `FluidSolver.js`, which will then pass them to the `splatFrag` shader.